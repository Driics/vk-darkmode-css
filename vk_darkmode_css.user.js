// ==UserScript==
// @run-at       document-start
// @name         NightMode for VK
// @version      1.0.0.3
// @description  Adds a nice, black-whity night mode for vk.
// @author       https://vk.com/id71110013
// @homepage     https://github.com/NIK220V/vk-darkmode-css
// @updateURL    https://github.com/NIK220V/vk-darkmode-css/raw/master/vk_darkmode_css.meta.js
// @downloadURL  https://github.com/NIK220V/vk-darkmode-css/raw/master/vk_darkmode_css.user.js
// @match        *://*.vk.com/*
// @grant        none
// ==/UserScript==

String.prototype.replaceAll = function(search, replacement) {
    var target = this;
    return target.replace(new RegExp(search, 'g'), replacement);
};

// Цвета, используемые скриптом. В теории можно изменить под свои и создать собственный цвет дизайна.
var colors = {
    very_gray: 'rgba(17, 17, 17, 1)',
    slightly_gray: 'rgba(35, 35, 35, 1)',
    slightly_gray_hovered: 'rgba(71, 71, 71, 1)',
    slighterer_gray_hovered: '#5d5c5c',
    okay_gray: 'rgba(136, 136, 136, 1)',
    unread_message: 'rgba(55, 55, 55, 1)',
    read_text: 'rgba(175, 175, 175, 1)',
    linked_gray: '#828282',
    linked_gray_light: '#999999',
    pure_white: 'white'
};

var interval = -1, socalled = 'vkdarkmode';

var css = document.createElement('style');
css.id = socalled;
css.innerText = `
/* == TEXT COLORS == */
body, h1, h2, h3, .module_header .header_top, .profile_info_header_wrap a, .left_count_wrap, .button_gray button, .flat_button.secondary, input.text.ts_input:focus, .page_counter .count, .ui_tab_sel, .ui_tabs .ui_tab_sel, .ui_tabs_box .ui_tab_sel, .wall_module .post_like:hover, .wall_module .post_reply:hover, .wall_module .post_share:hover, .button_blue button.hover, .button_blue button:hover, .flat_button.hover, .flat_button:hover, .fakeinput, .fakeinput~.placeholder .ph_input, div[contenteditable=true], div[contenteditable=true]~.placeholder .ph_input, input.big_text, input.big_text~.placeholder .ph_input, input.dark, input.dark~.placeholder .ph_input, input.search, input.search~.placeholder .ph_input, input.text, input.text~.placeholder .ph_input, textarea, textarea~.placeholder .ph_input, .ui_actions_menu_item, a.groups_messages_block, .page_actions_dd_label, .page_actions_header_inner, .page_actions_item, .page_actions_cont.narrow .page_actions_header_inner, .pv_like, .pv_like_count, .page_doc_row .page_doc_title, .wall_tt, ul.listing li span, .wk_sub_sub_header, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_hovered .nim-dialog--preview, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_hovered .nim-dialog--text-preview, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_unread.nim-dialog_classic .nim-dialog--preview, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_unread.nim-dialog_classic .nim-dialog--text-preview, .nim-dialog:not(.nim-dialog_deleted):hover .nim-dialog--preview, .nim-dialog:not(.nim-dialog_deleted):hover .nim-dialog--text-preview, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_hovered .nim-dialog--preview>b, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_unread.nim-dialog_classic .nim-dialog--preview>b, .nim-dialog:not(.nim-dialog_deleted):hover .nim-dialog--preview>b, .nim-dialog .nim-dialog--name .nim-dialog--name-w, .ui_rmenu_item, .ui_rmenu_subitem, .im-page .nim-conversation-search-row .nim-dialog--name .nim-dialog--name-w, .im-page .im-search-results-head, .im-popular--name, .im-page--title-main-inner, .nim-dialog.nim-dialog_classic.nim-dialog_unread-out .nim-dialog--inner-text, .nim-dialog.nim-dialog_classic.nim-dialog_unread-out.nim-dialog_muted .nim-dialog--inner-text, .nim-dialog.nim-dialog_typing .nim-dialog--typing, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_hovered .nim-dialog--preview.nim-dialog--preview-attach, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_unread.nim-dialog_classic .nim-dialog--preview.nim-dialog--preview-attach, .nim-dialog:not(.nim-dialog_deleted):hover .nim-dialog--preview.nim-dialog--preview-attach, .nim-dialog .nim-dialog--preview-attach, .im-to-end, .top_notify_header, .replies_open, .wr_header, .ui_tabs_box .ui_tab_sel .ui_tab_count, .box_title_wrap.box_grey .box_title, .page_block_header, .web_cam_photo_icon, .ui_ownblock_label, .page_media_poll_title, .wl_replies_header, .mv_title, #mv_comments_header, .subheader, h4.subheader, .result_list ul li.active, .result_list ul li, .im-page-pinned--media, .tt_w, .wddi_text, .ts_contact_name, .im-fwd .im-fwd--title, .feed_new_posts, .im-chat-input--editing-head, .ui_multiselect_cnt .token .token_title, .ui_search_filters_pane .token .token_title, .page_block_sub_header, .wk_header, a b, b a, .audio_pl_edit_box .ape_audio_item_wrap .ape_attach, .audio_page_player .audio_page_player_title, ._audio_section__search .audio_row.audio_has_lyrics .audio_row__title_inner, .ap_layer__content .audio_row.audio_has_lyrics .audio_row__title_inner, .audio_page__audio_rows .audio_row.audio_has_lyrics .audio_row__title_inner, .audio_section_global_search__audios_block .audio_row.audio_has_lyrics .audio_row__title_inner, .audio_row__more_actions .audio_row__more_action, .audio_page__shuffle_all .audio_page__shuffle_all_button, .post_from_tt_row, .tickets_header, .tickets_reply_text, .top_audio_player .top_audio_player_title, .tu_row_comment {color: %pure_white%;}
#side_bar ol li .left_row, input.ui_search_field {color: %okay_gray%;}
a, .nim-dialog .nim-dialog--preview, .nim-dialog .nim-dialog--text-preview, .im-fwd.im-fwd_msg .im-fwd--messages, .topics_module .topic_inner_link {color: %read_text%;}
.page_counter:hover .label, #stl_text {color: %slighterer_gray_hovered%;}
.post_like, .post_reply, .post_share, .wall_copy_more, .wall_post_more, .wall_reply_more, .wall_post_text a, .im-page .im-page--clear-recent, .im-page-btn, .im-page-pinned--name, .post_video_title, .ts_wrap .input_back_content, .top_notify_cont, .top_notify_cont .feedback_header, a.wall_reply_greeting {color: %linked_gray%;}
.im-mess-stack .im-mess-stack--content .im-mess-stack--pname>a, .im-right-menu .im-right-menu--count, .photos_album_intro .photos_album_intro_desc, .ui_rmenu_count.ui_rmenu_count_grey, .ui_ownblock_hint, .wide_column .topics_module .topic_title, .olist_item_name, .wall_module .media_desc .a, .tickets_author, .nim-dialog .nim-dialog--date, .tu_mem {color: %linked_gray_light%;}
/* == BACKGROUND COLORS == */
body, input.text.ts_input, input.text.ts_input:focus, .im-page--chat-header, .im-page .im-page--top-date-bar, .nim-dialog.nim-dialog_failed .nim-dialog--unread, .nim-dialog.nim-dialog_unread .nim-dialog--unread, .nim-dialog.nim-dialog_unread.nim-dialog_prep-injected .nim-dialog--unread, .nim-dialog.nim-dialog_classic.nim-dialog_unread-out .nim-dialog--inner-text, .nim-dialog.nim-dialog_classic.nim-dialog_unread-out.nim-dialog_muted .nim-dialog--inner-text, .nim-dialog.nim-dialog_classic:not(.nim-dialog_deleted).nim-dialog_hovered.nim-dialog_unread-out .nim-dialog--inner-text, .nim-dialog.nim-dialog_classic:not(.nim-dialog_deleted).nim-dialog_hovered.nim-dialog_unread-out.nim-dialog_muted .nim-dialog--inner-text, .nim-dialog.nim-dialog_classic:not(.nim-dialog_deleted).nim-dialog_unread.nim-dialog_classic.nim-dialog_unread-out .nim-dialog--inner-text, .nim-dialog.nim-dialog_classic:not(.nim-dialog_deleted).nim-dialog_unread.nim-dialog_classic.nim-dialog_unread-out.nim-dialog_muted .nim-dialog--inner-text, .nim-dialog.nim-dialog_classic:not(.nim-dialog_deleted):hover.nim-dialog_unread-out .nim-dialog--inner-text, .nim-dialog.nim-dialog_classic:not(.nim-dialog_deleted):hover.nim-dialog_unread-out.nim-dialog_muted .nim-dialog--inner-text, .nim-dialog.nim-dialog_failed.nim-dialog_muted .nim-dialog--unread, .nim-dialog.nim-dialog_unread.nim-dialog_muted .nim-dialog--unread, .nim-dialog.nim-dialog_unread.nim-dialog_prep-injected.nim-dialog_muted .nim-dialog--unread, .im-page .im-page--history-new-bar:after, .im-page .im-page--history-new-bar:before, .box_title_wrap, .box_controls, .im-mess.im-mess_unread:not(.im-mess_light), .im-page-pinned, .im-mess.im-mess_light, #wk_box, .wl_post_reply_form_forbidden, .top_nav_btn.active, .top_nav_btn:hover, .top_notify_show_all, .ui_tabs.ui_tabs_box, .replies_open, .wr_header, .emoji_cat_title, .im-page.im-page_classic.im-page_group .im-group-online, .page_media_poll_wrap, .wall_comments_header, .wall_module .page_media_thumbed_link, .emoji_tab_sel, .emoji_tab_sel:hover, .emoji_tabs_l_s, .emoji_tabs_r_s, .im-page_classic.im-page .im-chat-history-resize, .im-mess.im-mess_selected+.im-mess:before, .im-mess.im-mess_unread+.im-mess:before, .im-create .im-creation--item:hover, #feed_wall, .wk_extpage_footer_wrap, .audio_row__more_actions .audio_row__more_action:hover, .top_audio_player:hover {background-color: %very_gray%;}
input, #page_header_cont .back, .page_block, .profile_info_header, .profile_info_edit, .fakeinput, div[contenteditable=true], input.big_text, input.dark, input.search, input.text, textarea, .submit_post, #side_bar ol li .left_row:hover, .wall_module .reply_fakebox, .wall_module .reply_box, .wall_module .reply_fakebox_wrap, .wall_module .reply_form, .ui_actions_menu, .page_actions_wrap, .page_actions_header, .ms_items_more, .pv_cont .narrow_column, .pv_author_block, .tt_default, .tt_default_right, .im-page_classic.im-page .im-page--dcontent, .im-page .im-page--dialogs-footer.ui_grey_block, .ui_search, .im-page_classic.im-page .im-page--dialogs-search, .im-page_classic.im-page .im-page--chat-body-wrap-inner, .im-page--toolsw, .im-page_classic.im-page .im-page--chat-body-abs, .im-page_classic .im-page--chat-header-in, .im-page .im-page--history-new-bar, .im-chat-input.im-chat-input_classic, .im-chat-input, .im-page .im-page--header, .im-page .im-page--search-header, .im-mess.im-mess_selected:last-child:before, .im-mess.im-mess_unread:last-child:before, .box_body, .im-to-end .im-to-end--label, .chat_onl_inner, #top_notify_wrap, .top_notify_cont .feedback_row:not(.dld).hover, .top_notify_cont .feedback_row:not(.dld):hover, .top_notify_show_all:hover, .pv_white_bg, .photos_container .photos_row, .emoji_tt_wrap, .ui_tabs_header, .page_block_header, .photos_choose_upload_area, .web_cam_photo, .docs_choose_upload_area, .im-page.im-page_classic.im-page_group .im-group-online .im-group-online--inner, .stl_active.over_fast #stl_bg, .mv_info, .selector_container, .result_list ul, div.wdd, .emoji_tabs, .wddi, .ui_scroll_default_theme>.ui_scroll_bar_container>.ui_scroll_bar_outer>.ui_scroll_bar_inner, .ts_cont_wrap, .im-page .im-page--history-new-bar>span, .im-create .im-create--tabs, .im-create .im-creation--item.im-creation--item_hovered, .im-create .im-creation--item, .im-create, .im-create.im-create_classic .im-create--table, .im-create.im-create_classic .im-create--footer, .wk_text blockquote, .docs_panel, .audio_layer_container .audio_page_player, .audio_page_player .audio_page_player__cover, .eltt, .ui_search_sugg_list, .audio_page_layout .audio_friends_list, .wk_table th, .tickets_post_field, .faq_tabs.ui_tabs {box-shadow: none; background-color: %slightly_gray%;}
.button_gray button.hover, .button_gray button:hover, .flat_button.secondary.hover, .flat_button.secondary:hover, .button_blue button.hover, .button_blue button:hover, .flat_button.hover, .flat_button:hover {background-color: %slighterer_gray_hovered%;}
.my_current_info:hover, .profile_more_info_link:hover, #profile_groups_link:hover, .left_count_wrap, .button_gray button, .flat_button.secondary, .top_nav_link:hover, .wall_module .post_like:hover, .wall_module .post_reply:hover, .wall_module .post_share:hover, .button_blue button, .button_gray button, .button_light_gray button, .flat_button, .ui_actions_menu_item:hover, .page_actions_item:hover, .media_selector .ms_items_more .ms_item:hover, .pv_like:hover, .pv_cont .pv_can_edit:hover, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_hovered, .nim-dialog:not(.nim-dialog_deleted):hover, .ui_rmenu_item:hover, .ui_rmenu_subitem:hover, .ui_rmenu_item_sel, .ui_rmenu_item_sel:hover, .im-mess.im-mess_selected:not(.im-mess_is_editing), .im-mess.im-mess_selected:not(.im-mess_is_editing):hover, .chat_tab_wrap:hover, .im-mess.im-mess_search:hover, .audio_row:hover:not(.audio_row__current) .audio_row_content, .emoji_bg, .photos_choose_upload_area:hover, .web_cam_photo:hover, .docs_choose_upload_area:hover, .docs_choose_rows .docs_item:hover, .ui_ownblock:hover, #mv_comments_header, .result_list ul li.active, .feedback_row_wrap.unread:not(.feedback_row_touched), .im_msg_audiomsg .audio-msg-track:not(.audio-msg-player):hover, .summary_tab_sel .summary_tab2, .summary_tab_sel .summary_tab2:hover, .wddi_over, a.ts_contact.active, .im-mess.im-mess_selected+.im-mess:before, .emoji_tab:hover, .emoji_shop:hover, .ui_multiselect_cnt .token, .ui_search_filters_pane .token, .audio_pl_edit_box .ape_add_audios_btn:hover, .audio_pl_edit_box .ape_add_pl_audios_btn:hover, .ui_search_sugg_list .ui_search_suggestion_selected, .audio_page__shuffle_all .audio_page__shuffle_all_button:hover, .audio_layer_container .audio_friend:hover, .post_from_tt_row.active, .post_from_tt_row:hover, .tickets_header, .audio_row.audio_row__current .audio_row_content, .tu_last:hover {background-color: %slightly_gray_hovered%;}
#side_bar .left_icon, #side_bar ol li .left_row:hover, .media_selector .ms_item:before, .media_selector .ms_item:hover, input.text.ts_input, .wall_module .post_like_icon, .wall_module .post_reply_icon, .wall_module .post_share_icon, .wall_module .post_views_icon, .ui_tab_plain, .wall_module .like_wrap, .wall_module .reply_action, .wall_module .reply .reply_action:hover, .checkbox:before, .pv_like_icon, .page_doc_row .page_doc_icon, .topics_module .topic_icon, a.groups_messages_block:before, .ui_actions_menu_item.im-action:hover:before, .ui_actions_menu_item.im-action:before, .im-right-menu .im-right-menu--close:before, input.ui_search_field, .ui_calendar_icon, .ui_calendar_icon:hover, .im-mess .im-mess--check, .im-page--chat-header_actions .im-page--mess-actions, .im-page .im-page--dialogs-settings, .im-page--back-btn, .im-to-end, .chat_onl_cont, .top_nav_btn#top_notify_btn .top_nav_btn_icon, .top_nav_btn#top_audio:hover .top_nav_btn_icon, .top_nav_btn#top_audio .top_nav_btn_icon, .web_cam_photo_icon, .photos_choose_upload_area_label, .docs_choose_upload_area_label, .left_settings_inner, .ui_toggler, .box_x_button.box_x_tabs, .wall_module .my_like .post_like_icon, .wall_module .my_share .post_share_icon, .sort_not_rev_icon, .sort_rev_icon, #stl_text, .audio_row .audio_row__play_btn, .im-dialog-select .im-dialog-select--btn, .im-page--header-icon_answer:before, .im-page--header-icon_star:before, .im-page_classic.im-page .im-page--gim-mute, .audio-msg-track .audio-msg-track--wave-wrapper .audio-msg-track--wave, .audio-msg-track .audio-msg-track--btn, .feed_filter_icon, .feed_lists_icon .ui_actions_menu_icons, .page_actions_cont.narrow .page_actions_header, .page_actions_cont.narrow .page_extra_actions_btn, .wdd_add, .im-chat-input .im-chat-input--send, .emoji_smile_icon_vector, .im-chat-input .im-chat-input--attach-label, .ms_items_more_wrap.ms_items_more_wrap_vector .ms_item_more_label, .im-page_classic .im-page--chat-header_muted .im-page--title-main-in:after, .im-page--header-icon.im-page--header-icon_search:before, .im-page--header-more .ui_actions_menu_icons, .nim-dialog .nim-dialog--markre, .nim-dialog .nim-dialog--star, .ts_contact_status, .im-mess .im-mess--fav, .im-mess .im-mess--reply, .im-mess .im-mess--edit, .olist_checkbox, .ui_multiselect_cnt .token .token_del, .ui_search_filters_pane .token .token_del, .wall_module .media_desc b, .wall_module .media_preview .note b, .wall_module .media_preview .poll b, .wall_module .media_preview .share b, .page_upload_label, .box_body .ui_box_search, .radiobtn, .pv_cont .pv_closed_commments_placeholder, .emoji_smile_icon, .audio_page_player .audio_page_player__cover, .audio_page_player .audio_page_player_ctrl, .ui_search_new .ui_search_button_search, .audio_w_covers .audio_row .audio_row__cover, .audio_page__shuffle_all .audio_page__shuffle_all_button:before, .nim-dialog .nim-dialog--close, .nim-dialog.nim-dialog_muted .nim-dialog--mute, .nim-dialog.nim-dialog_unread.nim-dialog_prep-injected.nim-dialog_muted .nim-dialog--mute, .audio_row.audio_row__current .audio_row_content {filter: grayscale()!important}
.nim-dialog:not(.nim-dialog_deleted).nim-dialog_unread.nim-dialog_classic {background-color: %unread_message%;}
.ui_rmenu_sliding .ui_rmenu_slider, .feed_new_posts>b, .nim-dialog.nim-dialog_starred:before {background-color: %okay_gray%;}
.im-page--back-btn:hover, .im-chat-input .im-chat-input--txt-wrap, .emoji_cats_title_helper:after {background: none;}
.im-member-item .im-member-item--photo img {background-color: none;}
.im-page_classic.im-page .im-page--history_loading {box-shadow: none;}
.emoji_tabs_l_sc, .emoji_tabs_r_sc, .ui_scroll_default_theme.ui_scroll_emoji_theme>.ui_scroll_overflow>.ui_scroll_shadow_bottom, .ui_scroll_default_theme.ui_scroll_emoji_theme>.ui_scroll_overflow>.ui_scroll_shadow_top {display: none;}
/* == BORDER COLORS == */
#page_header_cont .back {border-bottom: none;}
.submit_post, .module, #ads_left.ads_left_empty+.left_menu_nav_wrap, #side_bar .more_div, .wall_module .copy_quote, .post_full_like_wrap, .wall_module .replies_list, .wall_module .reply~.reply .dld, .wall_module .reply~.reply .reply_wrap, .wall_module .reply_box, .wall_module .reply_fakebox_wrap, .ui_tab_sel, .ui_tab_sel:hover, .ui_tabs .ui_tab_sel, .ui_tabs .ui_tab_sel:hover, .ui_tabs_box .ui_tab_sel, .ui_tabs_box .ui_tab_sel:hover, .page_actions_inner, .pv_author_block, .post_publish, .nim-dialog:not(.nim-dialog_deleted).nim-dialog.nim-dialog_classic.nim-dialog_unread, .nim-dialog:not(.nim-dialog_deleted).nim-dialog.nim-dialog_hovered, .nim-dialog:not(.nim-dialog_deleted).nim-dialog:hover, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_hovered+.im-search-results-head, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_hovered+.nim-dialog, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_selected+.im-search-results-head, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_selected+.nim-dialog, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_unread.nim-dialog_classic+.im-search-results-head, .nim-dialog:not(.nim-dialog_deleted).nim-dialog_unread.nim-dialog_classic+.nim-dialog, .nim-dialog:not(.nim-dialog_deleted):hover+.im-search-results-head, .nim-dialog:not(.nim-dialog_deleted):hover+.nim-dialog, .nim-dialog .nim-dialog--content, .im-page .im-page--dialogs-footer, .ui_rmenu_item_sel, .ui_rmenu_item_sel:hover, .im-page--toolsw, .ui_actions_menu_sep, .im-chat-input, .im-page .im-page--top-date-bar, .im-chat-input .im-chat-input--txt-wrap, .pv_comments, .ui_search_filters_pane, .im-page .im-page--history-new-bar:after, .im-page .im-page--history-new-bar:before, .im_fwd_log_wrap, .im_wall_log_wrap, .im-member-item, .box_controls, .im-page-pinned, .im-to-end .im-to-end--label, .wl_post_reply_form_forbidden, .feed_row~.feed_row .feedback_row, .feed_row~.feed_row .feedback_sticky_row, .feed_row~.feed_row_fb_hidden .feed_row:first-child .feedback_row, .feedback_sticky_rows:not(:empty)+.feed_row .feedback_row, .feedback_sticky_rows:not(:empty)+.feed_row .feedback_sticky_row, .top_notify_header, .top_notify_show_all, .ui_tabs.ui_tabs_box, .box_title_wrap.box_grey, .flat_button.ui_load_more_btn, .friends_user_row, .docs_choose_rows .docs_item, .wall_comments_header, .wl_replies_header, .wall_module.wl_post .reply .reply_wrap, .top_nav_btn:hover .top_notify_count, .top_notify_count, .im-mess .im-mess--post, .profile_msg_split .profile_btn_cut_left, .profile_msg_split .profile_btn_cut_right, .wddi, .wddi_over, div.wdd, .fakeinput, .fakeinput~.placeholder .ph_input, input.big_text, input.big_text~.placeholder .ph_input, input.dark, input.dark~.placeholder .ph_input, input.search, input.search~.placeholder .ph_input, input.text, input.text~.placeholder .ph_input, textarea, textarea~.placeholder .ph_input, .im-fwd, .ui_tabs, .im-create .im-creation--item.im-creation--item_hovered, .im-create .im-creation--item:hover, .olist_item_wrap, .ui_search, .ui_grey_block, .search_results_sep, .wk_extpage_footer_wrap, .wk_text blockquote, .page_actions_separator, .audio_pl_edit_box .ape_add_audios_btn, .audio_pl_edit_box .ape_add_pl_audios_btn, .audio_layer_container .audio_page_player, .eltt, .ui_search_new .ui_search_button_search, .ui_search_new .ui_search_input_inner, .ui_search_sugg_list, .audio_page_layout .has_friends_block .audio_page__rows_wrap, .wk_table, .wk_table th, .wk_table td, .tickets_header, .tickets_post_form__panel, .tickets_post_field, .page_block_header, .tu_row, .tickets_reply_row, .help_table_question {border-color: %okay_gray%;}
.ui_actions_menu, .page_actions_wrap, .page_actions_header, .ms_items_more, .tt_default, .tt_default_right, .im-page_classic .im-page--chat-header, .im-page_classic.im-page .im-page--chat-input, .im-page_classic.im-page .im-page--chat-body-wrap-inner, .im-page_classic.im-page .im-page--header, .emoji_tt_wrap, .selector_focused table.selector_table, .wdd_list, .online:after {border-color: %very_gray%;}
#top_notify_wrap, .photos_container .photos_row {border-color: %slightly_gray%;}
.group_friends_image {border-color: %slightly_gray_hovered%;}

/* == UI TRICKS == */
.image_cover, .photos_choose_row {border-radius: 5px;}

/* == SCREW DEFAULT API IMAGE == */
.wall_post_source_icon {background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAMAAACecocUAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABU1BMVEUAAAD///8REREZGRkAAAAEBAQEBAQAAAAZGRkREREjIyMAAAALCwsPDg0OBQMPDg0LCwsAAAAjIyMUFBRTUVHQsKrQsKpTUVEUFBQFBQXj4eHt8PD/5N3/VjP/5N7t8PDj4eEFBQUAAACenp5hcnZhcnaenp4AAAAAAABdX2AHl7gHl7hdX2AAAAAAAABDQkIraXgyPkEyPkEraXhDQkIAAAAVFRXHvbuopqWfoKCopqXHvbsVFRUAAAC8vr9wcHFwcXG9v78AAAAAAAAEBATZ2dnf39/Z2dkEBAQAAAAAAAAAAAABAQEqKioqKioBAQEAAAAAAABGRkZGRkZCQkKyurzEIgKyurxCQkJxcXFxcXGIiIh6fH11Y2B6fH2IiIh1dHQHJSwAAAAHJi11dHR4eHgsJiR4eHiQkJCQkJBDQ0NKSUlCQkJubm5ubm5DQ0P///8TfFsbAAAAUnRSTlMAAMb6LwICL/rG75yLoJygi5zvtPv///u0svr7+/v7+/qytP3///20m/z///ybH+z+///+7CDN/f////3NfPn+/vl8B779//2+BwELi+vriwsBriooAgAAAAFiS0dEAf8CLd4AAAAHdElNRQfhDBYUKBWK4cYoAAAAhUlEQVQI1wXBQwICAAAEwM22bdu2bduu/9+aAZFEBgVU0OgMMIcsNofL4wtGQojG4olkKp3J5nIoFkqVWqPV6ZcGGFcm83qztVh3Ntj3DufheHK5zx54fRd/4BoM3cIREKL3WDyRTD3SBCDzzOZe+cK7CKBU/lSqtW+9ATTRand+3V4fgz8s+hhKWwGqOQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNy0xMi0yMlQyMDo0MDoyMS0wNTowMAmNQVUAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTctMTItMjJUMjA6NDA6MjEtMDU6MDB40PnpAAAAAElFTkSuQmCC');}
`;
for (var key in colors) css.innerText = css.innerText.replaceAll('%'+key+'%', colors[key]+'!important');

if (localStorage.getItem('VKDarkMode') === null) localStorage.setItem('VKDarkMode', false);
var darkmodeEnabled = localStorage.getItem('VKDarkMode') == 'true';

var ptp = document.querySelector('#top_nav > div.head_nav_item.fl_l.head_nav_btns');
var div = document.createElement('div');
div.innerHTML = `<a id="top_nightmode" class="top_nav_btn" href="#" onmousedown="toggleNightMode()" onclick="return checkEvent(event);" aria-label="Ночной режим" aria-haspopup="false" accesskey="4">
    <span class="blind_label">Ночной режим</span>
    <div class="top_nav_btn_icon"><svg viewBox="0 0 24 24" style="fill: rgb(56, 56, 56);pointer-events: none;display: block;width: 100%;height: 100%;"><g>
        <path d="M12.7 2C7.33 2.15 3 6.57 3 12c0 5.52 4.48 10 10 10 3.52 0 6.6-1.82 8.4-4.56h-.3c-5.52 0-10-4.48-10-10 0-2 .6-3.87 1.6-5.44z"></path>
      </g></svg></div>
</a>`;
setTimeout(function(){if (document.querySelector('#top_nav > div.head_nav_item.fl_l.head_nav_btns')) document.querySelector('#top_nav > div.head_nav_item.fl_l.head_nav_btns').appendChild(div.firstChild);}, 2500);

var appended = false;

if (darkmodeEnabled == true) {
    document.head.appendChild(css);
    appended = true;
    interval = setInterval(function(){
        if (document.head.lastChild.id != socalled) swapElements(css, document.head.lastChild);
    }, 250);
}
function swapElements(obj1, obj2) {
    if (obj1.id == obj2.id) return;
    var temp = document.createElement("div");
    obj1.parentNode.insertBefore(temp, obj1);
    obj2.parentNode.insertBefore(obj1, obj2);
    temp.parentNode.insertBefore(obj2, temp);
    temp.parentNode.removeChild(temp);
}

window.toggleNightMode = function(){
    darkmodeEnabled = !darkmodeEnabled;
    localStorage.setItem('VKDarkMode', darkmodeEnabled);
    if (darkmodeEnabled) {
        if (!appended) document.head.appendChild(css);
        interval = setInterval(function(){
            if (document.head.lastChild.id != socalled) swapElements(css, document.head.lastChild);
        }, 250);
    } else {
        if (interval >= 0) clearInterval(interval);
        appended = false;
        document.head.removeChild(css);
    }
};
